{% extends 'admin/base_admin.html' %}


{% block extra_head %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tinymce/6.8.3/tinymce.min.js"></script>
{% endblock %}

{% block content %}

    <a href="/admin" class="back-link">‚Üê –Ω–∞–∑–∞–¥</a>

    <form method="POST" id="post-form">
        <div class="editor-layout">
            <!-- Main editor -->
            <div class="editor-main">
                <input
                    type="text"
                    name="title"
                    id="title-input"
                    placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ—Å—Ç–∞..."
                    value="{{ post.title if post else '' }}"
                    required
                >
                <textarea name="content" id="editor">{{ post.content if post else '' }}</textarea>
            </div>

            <!-- Sidebar -->
            <div class="editor-sidebar">
                <div class="sidebar-card">
                    <h3>–ü—É–±–ª–∏–∫–∞—Ü–∏—è</h3>
                    <label class="checkbox-label">
                        <input type="checkbox" id="published-checkbox" name="published" {{ 'checked' if (post and post.published) }}>
                        –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å
                    </label>
                    <div style="margin-top:1.2rem; display:flex; flex-direction:column; gap:0.6rem;">
                        <button type="submit" id="submit-btn" class="btn btn-green" style="justify-content:center;">
                            {{ 'üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å' if post else 'üöÄ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å' }}
                        </button>
                        {% if post %}
                        <a href="/admin/post/{{ post.id }}/preview" target="_blank" class="btn btn-outline" style="justify-content:center;">
                            üëÅ –ü—Ä–æ—Å–º–æ—Ç—Ä
                        </a>
                        {% endif %}
                    </div>
                </div>

                <div class="sidebar-card">
                    <h3>–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</h3>
                    <div class="field-group">
                        <textarea name="excerpt" id="excerpt" rows="3"
                            placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã..."
                            style="resize:vertical; font-size:0.83rem;">{{ post.excerpt if post else '' }}</textarea>
                    </div>
                </div>

                <div class="sidebar-card">
                    <h3>–¢–µ–≥–∏</h3>
                    <div class="field-group">
                        <input type="text" name="tags"
                            value="{{ post.tags if post else '' }}"
                            placeholder="linux, devops, docker">
                        <div style="font-size:0.73rem; color:var(--text-dim); margin-top:0.4rem;">—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é</div>
                    </div>
                </div>
            </div>
        </div>
    </form>
{% endblock %}

{% block extra_scripts %}
<script>


    // –¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —á–µ–∫–±–æ–∫—Å–∞
const checkbox = document.getElementById('published-checkbox');
const btn = document.getElementById('submit-btn');

function updateBtn() {
    btn.textContent = checkbox.checked ? 'üöÄ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å' : 'üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ —á–µ—Ä–Ω–æ–≤–∏–∫';
}

// –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
updateBtn();

// –ú–µ–Ω—è—Ç—å –ø—Ä–∏ –∫–ª–∏–∫–µ
checkbox.addEventListener('change', updateBtn);

// TinyMCE
tinymce.init({
    selector: '#editor',
    height: 600,
    plugins: [
        'advlist', 'autolink', 'lists', 'link', 'image', 'charmap',
        'preview', 'anchor', 'searchreplace', 'visualblocks', 'code',
        'fullscreen', 'insertdatetime', 'media', 'table', 'code',
        'codesample', 'emoticons'
    ],
    toolbar: [
        'undo redo | blocks | bold italic | forecolor backcolor',
        'alignleft aligncenter alignright | bullist numlist outdent indent',
        'link image media | codesample code | table | fullscreen preview'
    ].join(' | '),
    toolbar_mode: 'wrap',

    // –¢—ë–º–Ω–∞—è —Ç–µ–º–∞
    skin: 'oxide-dark',
    content_css: 'dark',

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    images_upload_url: '/admin/upload',
    images_upload_credentials: true,
    automatic_uploads: true,
    file_picker_types: 'image',

    // Highlight.js –¥–ª—è –±–ª–æ–∫–æ–≤ –∫–æ–¥–∞
    codesample_languages: [
        {text: 'Bash', value: 'bash'},
        {text: 'Python', value: 'python'},
        {text: 'JavaScript', value: 'javascript'},
        {text: 'YAML', value: 'yaml'},
        {text: 'JSON', value: 'json'},
        {text: 'Dockerfile', value: 'dockerfile'},
        {text: 'Nginx', value: 'nginx'},
        {text: 'SQL', value: 'sql'},
        {text: 'Go', value: 'go'},
        {text: 'Rust', value: 'rust'},
        {text: 'XML', value: 'xml'},
        {text: 'Markdown', value: 'markdown'},
    ],

content_style: `
    body {
        font-family: Georgia, serif;
        font-size: 15px;
        line-height: 1.8;
        color: #c8d8d0;
        background: #111414;
        max-width: 720px;
        margin: 1rem auto;
        padding: 0 1rem;
    }

    /* –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –±–ª–æ–∫ –∫–æ–¥–∞ */
    pre {
        background: #0d0f0f;
        border: 1px solid #2a3333;
        border-radius: 6px;
        padding: 1.2rem 1rem 1rem;
        overflow-x: auto;
        position: relative;
        margin: 1.5rem 0;
    }

    /* –õ–µ–π–±–ª —è–∑—ã–∫–∞ */
    pre::before {
        content: attr(data-language);
        position: absolute;
        top: 0;
        right: 0;
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.7rem;
        color: #6b8080;
        background: #1a1f1f;
        padding: 0.15rem 0.6rem;
        border-radius: 0 6px 0 4px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    code {
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.85em;
        background: #1a1f1f;
        padding: 0.15em 0.4em;
        border-radius: 3px;
        color: #00d4ff;
    }
    pre code { background: none; padding: 0; color: #c8d8d0; }
    h2 { border-left: 3px solid #00ff9f; padding-left: 0.8rem; }
    a { color: #00ff9f; }
    blockquote {
        border-left: 3px solid #ffd700;
        padding: 0.5rem 1rem;
        background: rgba(255,215,0,0.04);
        color: #6b8080;
        font-style: italic;
        margin: 1.5rem 0;
    }
`,

    setup: function(editor) {
        // Ctrl+S –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        editor.addShortcut('ctrl+s', 'Save post', function() {
            document.getElementById('post-form').submit();
        });
    }
});
</script>

{% endblock %}